<odoo>

    <template id="report_timesheet_custom" inherit_id="hr_timesheet.report_timesheet">
		<xpath expr="//tbody" position="replace">
			<tbody>
				<t t-set="total_planned_hours" t-value="0"/>
				<tr t-foreach="docs" t-as="l">
					<t t-set="total_planned_hours" t-value="total_planned_hours + l.task_id.planned_hours"/>
					<td>
					   <span t-field="l.date"/>
					</td>
					<td>
					   <span t-field="l.user_id.partner_id.name"/>
					</td>
					<td >
						<span t-field="l.name" t-options="{'widget': 'text'}"/>
					</td>
					<td t-if="show_task">
						<t t-if="show_project"><span t-field="l.project_id.name"/></t>
						<t t-if="show_project and l.task_id"> - </t>
						<t t-if="l.task_id"><span t-field="l.task_id.name"/></t>
					</td>
					<td class="text-right">
						<span t-field="l.unit_amount" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}"/>
					</td>
				</tr>
				<tr>
					<td />
					<td />
					<td t-if="show_task"/>
					<td style="width:50px" class="text-left"><strong>Horas consumidas</strong></td>
					<td style="width:50px" class="text-right"><strong t-esc="sum(docs.mapped('unit_amount'))" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}"/></td>
				</tr>
				<tr>
					<td />
					<td />
					<td t-if="show_task"/>
					<td style="width:50px" class="text-left"><strong>Horas contratadas</strong></td>
					<td style="width:50px" class="text-right"><strong t-esc="total_planned_hours" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}"/></td>
					<!-- <td style="width:50px" class="text-right"><strong t-esc="docs[0].task_id.planned_hours" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}"/></td> -->
				</tr>
				<tr>
					<td />
					<td />
					<td t-if="show_task"/>
					<td style="width:50px" class="text-left"><strong>Horas restantes</strong></td>
					<td style="width:50px" class="text-right">
						<t t-set="resta" t-value="docs[0].task_id.planned_hours - sum(docs.mapped('unit_amount'))" />
						<t t-if="resta &lt; 0">
							<strong t-esc="resta*-1" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}"/>
						</t>
						<t t-else="">
							<strong t-esc="resta" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}"/>  
						</t>
					</td>
					<!-- <td style="width:50px" class="text-right"><strong t-esc="docs[0].task_id.planned_hours - sum(docs.mapped('unit_amount'))" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}"/> -->
				</tr>
			</tbody>
		</xpath>
	</template>
	
</odoo>